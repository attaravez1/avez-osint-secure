<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avez OSINT-X Web</title>
    <style>
        * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body {
            background-color: #0d1117;
            color: #c9d1d9;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #161b22;
            border-radius: 8px;
            padding: 30px;
            border: 1px solid #30363d;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        h1 {
            color: #58a6ff;
            margin-top: 0;
            border-bottom: 1px solid #30363d;
            padding-bottom: 10px;
        }
        .subtitle {
            color: #8b949e;
            margin-bottom: 25px;
        }
        .input-section {
            margin-bottom: 30px;
            background: #0d1117;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #30363d;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #58a6ff;
        }
        .input-group {
            display: flex;
            gap: 10px;
        }
        input[type="text"] {
            flex-grow: 1;
            padding: 12px 15px;
            background-color: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            color: #c9d1d9;
            font-size: 16px;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #1f6feb;
        }
        button {
            padding: 12px 25px;
            background-color: #238636;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #2ea043;
        }
        button:disabled {
            background-color: #30363d;
            cursor: not-allowed;
        }
        #clearBtn {
            background-color: #da3633;
        }
        #clearBtn:hover {
            background-color: #f85149;
        }
        .config {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            font-size: 14px;
        }
        .config input, .config select {
            padding: 8px;
            background-color: #0d1117;
            border: 1px solid #30363d;
            border-radius: 4px;
            color: #c9d1d9;
        }
        .status {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
            font-weight: bold;
        }
        .status.loading {
            display: block;
            background-color: #1c2128;
            border: 1px solid #30363d;
            color: #8b949e;
        }
        .status.error {
            display: block;
            background-color: #3c1e1e;
            border: 1px solid #5c1a1a;
            color: #f85149;
        }
        .results {
            background-color: #0d1117;
            border-radius: 6px;
            border: 1px solid #30363d;
            padding: 20px;
            min-height: 100px;
            max-height: 70vh;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .db-header {
            color: #a371f7;
            margin-top: 20px;
            margin-bottom: 10px;
            font-weight: bold;
            font-size: 1.1em;
            padding-bottom: 5px;
            border-bottom: 1px dashed #30363d;
        }
        .entry {
            background-color: #161b22;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #58a6ff;
            overflow-x: auto;
        }
        .entry pre {
            margin: 0;
            color: #8b949e;
        }
        .no-data {
            color: #8b949e;
            font-style: italic;
            text-align: center;
            padding: 30px;
        }
        .footer {
            margin-top: 30px;
            text-align: center;
            font-size: 12px;
            color: #484f58;
            border-top: 1px solid #30363d;
            padding-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç OSINT-X Web Interface</h1>
        <p class="subtitle">Check the digital footprint via phone number or email address. No logs, no traces.</p>

        <div class="input-section">
            <label for="queryInput">Target (Phone/Email):</label>
            <div class="input-group">
                <input type="text" id="queryInput" placeholder="e.g., +79123456789 or target@example.com" autocomplete="off" />
                <button id="searchBtn">Search</button>
                <button id="clearBtn">Clear</button>
            </div>
            <div class="config">
                <div>
                    <label for="limit">Limit:</label>
                    <input type="number" id="limit" value="300" min="1" max="1000" />
                </div>
                <div>
                    <label for="lang">Language:</label>
                    <select id="lang">
                        <option value="ru">Russian (ru)</option>
                        <option value="en">English (en)</option>
                    </select>
                </div>
            </div>
        </div>

        <div id="statusEl" class="status"></div>

        <div class="results" id="resultsEl">
            <div class="no-data">No query executed. Enter a target above.</div>
        </div>

        <div class="footer">
            <div>Uses the Leak OSINT API. Results are for educational purposes only.</div>
            <div style="margin-top: 5px; font-size: 10px; color: #30363d;">Interface by Just-Lisa | Secure Backend | No API Key Exposure</div>
        </div>
    </div>

    <script>
        // Configuration - NO API KEY HERE
        const DEFAULT_LANG = 'ru';
        const DEFAULT_LIMIT = 300;
        const REQUEST_TIMEOUT = 15000; // ms

        // DOM Elements
        const queryInput = document.getElementById('queryInput');
        const searchBtn = document.getElementById('searchBtn');
        const clearBtn = document.getElementById('clearBtn');
        const limitInput = document.getElementById('limit');
        const langSelect = document.getElementById('lang');
        const statusEl = document.getElementById('statusEl');
        const resultsEl = document.getElementById('resultsEl');

        // Format response as JS-like object
        function formatAsJs(data) {
            if (typeof data !== 'object' || data === null) {
                return JSON.stringify(data, null, 2);
            }
            const lines = [];
            for (const [key, value] of Object.entries(data)) {
                try {
                    const valueStr = JSON.stringify(value, null, 2)
                                        .split('\n')
                                        .map((line, idx) => idx === 0 ? line : '  ' + line)
                                        .join('\n');
                    lines.push(`  ${key}: ${valueStr}`);
                } catch (e) {
                    lines.push(`  ${key}: "<unserializable>"`);
                }
            }
            return '{\n' + lines.join('\n') + '\n}';
        }

        // Pretty print the API response
        function prettyPrintResponse(response) {
            resultsEl.innerHTML = '';

            if (response['Error code']) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'status error';
                errorDiv.textContent = `üö´ API Error: ${response['Error code']}`;
                resultsEl.appendChild(errorDiv);
                return;
            }

            const lst = response['List'];
            if (!lst || Object.keys(lst).length === 0) {
                resultsEl.innerHTML = '<div class="no-data">‚ùå No data found for this target.</div>';
                return;
            }

            for (const [db, dbinfo] of Object.entries(lst)) {
                const dbTitle = (String(db).toLowerCase() === '1win') ? 'Avez OSINT-X' : db;
                const dbHeader = document.createElement('div');
                dbHeader.className = 'db-header';
                dbHeader.textContent = `üìÅ Database: ${dbTitle}`;
                resultsEl.appendChild(dbHeader);

                const dataList = (typeof dbinfo === 'object' && dbinfo !== null) ? dbinfo['Data'] : null;
                if (!dataList || !Array.isArray(dataList) || dataList.length === 0) {
                    const noEntries = document.createElement('div');
                    noEntries.textContent = '  (no entries)';
                    noEntries.style.color = '#8b949e';
                    noEntries.style.marginLeft = '10px';
                    resultsEl.appendChild(noEntries);
                    continue;
                }

                dataList.forEach(entry => {
                    const entryDiv = document.createElement('div');
                    entryDiv.className = 'entry';
                    const pre = document.createElement('pre');
                    const dataToFormat = (typeof entry === 'object' && entry !== null) ? entry : { value: entry };
                    pre.textContent = formatAsJs(dataToFormat);
                    entryDiv.appendChild(pre);
                    resultsEl.appendChild(entryDiv);
                });
            }
        }

        // Query the API via our secure backend
        async function queryApi(query) {
            const limit = parseInt(limitInput.value) || DEFAULT_LIMIT;
            const lang = langSelect.value || DEFAULT_LANG;

            const payload = {
                request: query,  // NO TOKEN SENT FROM FRONTEND
                limit: limit,
                lang: lang
            };

            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), REQUEST_TIMEOUT);

            try {
                const response = await fetch('/api/query', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                    signal: controller.signal
                });
                clearTimeout(timeoutId);

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Backend error: ${response.status} - ${errorText}`);
                }

                const data = await response.json();
                if (typeof data !== 'object') {
                    throw new Error('Backend returned non-object response');
                }
                return data;

            } catch (error) {
                clearTimeout(timeoutId);
                if (error.name === 'AbortError') {
                    throw new Error(`Request timed out after ${REQUEST_TIMEOUT/1000} seconds`);
                }
                throw error;
            }
        }

        // Event Handlers
        searchBtn.addEventListener('click', async () => {
            const query = queryInput.value.trim();
            if (!query) {
                alert('Please enter a phone number or email address.');
                return;
            }

            // UI state
            searchBtn.disabled = true;
            searchBtn.textContent = 'Searching...';
            statusEl.className = 'status loading';
            statusEl.textContent = `Querying: ${query} ...`;
            statusEl.style.display = 'block';

            try {
                const response = await queryApi(query);
                statusEl.style.display = 'none';
                prettyPrintResponse(response);
            } catch (error) {
                console.error('Query failed:', error);
                statusEl.className = 'status error';
                statusEl.textContent = `‚ùå Request failed: ${error.message}`;
                resultsEl.innerHTML = `<div class="status error">${error.message}</div>`;
            } finally {
                searchBtn.disabled = false;
                searchBtn.textContent = 'Search';
            }
        });

        clearBtn.addEventListener('click', () => {
            queryInput.value = '';
            resultsEl.innerHTML = '<div class="no-data">No query executed. Enter a target above.</div>';
            statusEl.style.display = 'none';
        });

        queryInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchBtn.click();
            }
        });

        // Optional: Load from URL parameter
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const presetQuery = urlParams.get('q');
            if (presetQuery) {
                queryInput.value = presetQuery;
            }
        });
    </script>




<!-- Working Cybersecurity Chatbot Widget - No API Key Required -->
<div id="chatbot-container">
    <button id="chatbot-toggle" title="Ask Cybersecurity Questions">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10z"></path>
        </svg>
    </button>

    <div id="chatbot-window">
        <div class="chat-header">
            <h3>üîí Cybersecurity AI Assistant</h3>
            <button id="chatbot-close">&times;</button>
        </div>

        <div id="chat-messages">
            <div class="message bot">
                <div class="message-content">
                    <strong>Cybersecurity AI:</strong> Using free AI model (OpenRouter).<br>
                    Ask me about:<br>
                    ‚Ä¢ Hacking techniques & tools<br>
                    ‚Ä¢ OSINT methods<br>
                    ‚Ä¢ Network security<br>
                    ‚Ä¢ Security best practices<br>
                    <small><em>No API key required. Rate limited.</em></small>
                </div>
            </div>
        </div>

        <div class="chat-input-area">
            <textarea id="chat-input" placeholder="Ask cybersecurity questions... (Enter to send)" rows="1"></textarea>
            <button id="send-button">Send</button>
        </div>
        
        <div id="chat-status">Status: Ready</div>
    </div>
</div>

<style>
/* Same CSS styles as before - keep all your existing CSS */
#chatbot-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1000;
}

#chatbot-toggle {
    position: absolute;
    bottom: 0;
    right: 0;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, #58a6ff, #a371f7);
    color: white;
    border: none;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

#chatbot-toggle:hover {
    transform: scale(1.1);
    background: linear-gradient(135deg, #1f6feb, #8957e5);
}

#chatbot-window {
    position: absolute;
    bottom: 70px;
    right: 0;
    width: 400px;
    max-width: 90vw;
    height: 500px;
    max-height: 70vh;
    background-color: #161b22;
    border: 1px solid #30363d;
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    display: none;
    flex-direction: column;
    overflow: hidden;
}

#chatbot-window.active {
    display: flex;
}

.chat-header {
    padding: 15px 20px;
    background-color: #1c2128;
    border-bottom: 1px solid #30363d;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.chat-header h3 {
    margin: 0;
    color: #58a6ff;
    font-size: 16px;
}

#chatbot-close {
    background: none;
    border: none;
    color: #8b949e;
    font-size: 24px;
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    line-height: 1;
}

#chatbot-close:hover {
    color: #f85149;
}

#chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.message {
    max-width: 85%;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.message.user {
    align-self: flex-end;
}

.message.bot {
    align-self: flex-start;
}

.message-content {
    padding: 12px 16px;
    border-radius: 18px;
    line-height: 1.5;
    font-size: 14px;
}

.message.user .message-content {
    background: linear-gradient(135deg, #1f6feb, #0d419d);
    color: white;
    border-bottom-right-radius: 4px;
}

.message.bot .message-content {
    background-color: #21262d;
    color: #c9d1d9;
    border: 1px solid #30363d;
    border-bottom-left-radius: 4px;
}

.message.bot .message-content strong {
    color: #58a6ff;
    display: block;
    margin-bottom: 5px;
}

.message.bot .message-content pre,
.message.bot .message-content code {
    background-color: #0d1117;
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Consolas', monospace;
    margin: 5px 0;
    overflow-x: auto;
}

.chat-input-area {
    padding: 15px 20px;
    border-top: 1px solid #30363d;
    background-color: #1c2128;
    display: flex;
    gap: 10px;
    align-items: flex-end;
}

#chat-input {
    flex: 1;
    padding: 12px 15px;
    background-color: #0d1117;
    border: 1px solid #30363d;
    border-radius: 8px;
    color: #c9d1d9;
    font-family: inherit;
    font-size: 14px;
    resize: none;
    max-height: 120px;
    min-height: 44px;
    line-height: 1.5;
}

#chat-input:focus {
    outline: none;
    border-color: #58a6ff;
}

#send-button {
    padding: 12px 20px;
    background-color: #238636;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.2s;
    height: 44px;
    white-space: nowrap;
}

#send-button:hover:not(:disabled) {
    background-color: #2ea043;
}

#send-button:disabled {
    background-color: #30363d;
    cursor: not-allowed;
    opacity: 0.7;
}

#chat-status {
    padding: 8px 20px;
    background-color: #1c2128;
    color: #8b949e;
    font-size: 12px;
    text-align: center;
    border-top: 1px solid #30363d;
    min-height: 34px;
}

.typing-indicator {
    display: inline-flex;
    align-items: center;
    gap: 4px;
}

.typing-indicator span {
    width: 8px;
    height: 8px;
    background-color: #58a6ff;
    border-radius: 50%;
    animation: typing 1.4s infinite ease-in-out;
}

.typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
.typing-indicator span:nth-child(2) { animation-delay: -0.16s; }

@keyframes typing {
    0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
    40% { transform: scale(1); opacity: 1; }
}

#chat-messages::-webkit-scrollbar {
    width: 8px;
}

#chat-messages::-webkit-scrollbar-track {
    background: #0d1117;
}

#chat-messages::-webkit-scrollbar-thumb {
    background: #30363d;
    border-radius: 4px;
}

#chat-messages::-webkit-scrollbar-thumb:hover {
    background: #484f58;
}

@media (max-width: 768px) {
    #chatbot-container {
        bottom: 10px;
        right: 10px;
    }
    
    #chatbot-window {
        width: calc(100vw - 40px);
        max-width: none;
        right: -10px;
    }
}
</style>

<script>
// WORKING CHATBOT USING FREE AI API (OpenRouter)
// No API key required for basic usage
const AI_CONFIG = {
    // Free AI endpoints (no API key required or free tier)
    endpoints: [
        {
            name: 'OpenRouter Free',
            url: 'https://openrouter.ai/api/v1/chat/completions',
            model: 'mistralai/mistral-7b-instruct:free',
            headers: {
                'Content-Type': 'application/json',
                'HTTP-Referer': window.location.origin,
                'X-Title': 'Cybersecurity Assistant'
            }
        },
        {
            name: 'HuggingFace Free',
            url: 'https://api-inference.huggingface.co/models/mistralai/Mistral-7B-Instruct-v0.2',
            model: 'mistralai/Mistral-7B-Instruct-v0.2',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer hf_free_token' // Can sometimes work without
            }
        }
    ],
    
    // Cybersecurity system prompt
    systemPrompt: `You are a cybersecurity expert assistant. Provide educational information about:
- Ethical hacking and penetration testing
- OSINT (Open Source Intelligence) tools and methods
- Network security and firewall configurations
- Malware analysis and reverse engineering basics
- Security best practices and compliance
- Cryptography and encryption methods
- Incident response procedures

Rules:
1. Provide detailed technical explanations
2. Include code examples when relevant (Python, Bash, PowerShell)
3. Explain security concepts clearly
4. Focus on legal and ethical education
5. Never provide instructions for illegal activities
6. Format responses with clear sections

Always start with: "üîê Cybersecurity Expert:"`
};

// DOM Elements
const chatbotToggle = document.getElementById('chatbot-toggle');
const chatbotWindow = document.getElementById('chatbot-window');
const chatbotClose = document.getElementById('chatbot-close');
const chatMessages = document.getElementById('chat-messages');
const chatInput = document.getElementById('chat-input');
const sendButton = document.getElementById('send-button');
const chatStatus = document.getElementById('chat-status');

// Chat state
let isChatbotOpen = false;
let conversationHistory = [];

// Initialize
function initChatbot() {
    const savedHistory = localStorage.getItem('cyber_chat_history');
    if (savedHistory) {
        try {
            conversationHistory = JSON.parse(savedHistory).slice(-5);
        } catch (e) {
            conversationHistory = [];
        }
    }
    
    // Set initial status
    chatStatus.textContent = 'Using free AI model. Rate limits apply.';
}

// Toggle window
chatbotToggle.addEventListener('click', () => {
    isChatbotOpen = !isChatbotOpen;
    chatbotWindow.classList.toggle('active', isChatbotOpen);
    if (isChatbotOpen) chatInput.focus();
    scrollToBottom();
});

chatbotClose.addEventListener('click', () => {
    isChatbotOpen = false;
    chatbotWindow.classList.remove('active');
});

// Textarea auto-resize
chatInput.addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = (this.scrollHeight) + 'px';
});

// Send on Enter (Shift+Enter for new line)
chatInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
    }
});

sendButton.addEventListener('click', sendMessage);

// Add message to UI
function addMessage(text, isUser = false) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
    
    const contentDiv = document.createElement('div');
    contentDiv.className = 'message-content';
    
    // Basic formatting
    let formattedText = text
        .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
        .replace(/`([^`]+)`/g, '<code>$1</code>')
        .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
        .replace(/\n/g, '<br>');
    
    contentDiv.innerHTML = formattedText;
    messageDiv.appendChild(contentDiv);
    chatMessages.appendChild(messageDiv);
    
    // Save to history (limited)
    conversationHistory.push({
        role: isUser ? 'user' : 'assistant',
        content: text,
        timestamp: Date.now()
    });
    
    if (conversationHistory.length > 10) {
        conversationHistory = conversationHistory.slice(-10);
    }
    
    localStorage.setItem('cyber_chat_history', JSON.stringify(conversationHistory));
    scrollToBottom();
}

// Show typing indicator
function showTyping() {
    const typingDiv = document.createElement('div');
    typingDiv.className = 'message bot';
    typingDiv.id = 'typing-indicator';
    
    const contentDiv = document.createElement('div');
    contentDiv.className = 'message-content';
    contentDiv.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>';
    
    typingDiv.appendChild(contentDiv);
    chatMessages.appendChild(typingDiv);
    scrollToBottom();
}

function hideTyping() {
    const typingIndicator = document.getElementById('typing-indicator');
    if (typingIndicator) typingIndicator.remove();
}

function scrollToBottom() {
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Main send function
async function sendMessage() {
    const message = chatInput.value.trim();
    if (!message) return;
    
    // Clear input and disable
    chatInput.value = '';
    chatInput.style.height = 'auto';
    sendButton.disabled = true;
    chatInput.disabled = true;
    
    // Add user message
    addMessage(message, true);
    showTyping();
    
    // Try endpoints in order
    let success = false;
    
    for (const endpoint of AI_CONFIG.endpoints) {
        chatStatus.textContent = `Trying ${endpoint.name}...`;
        
        try {
            const response = await queryAI(endpoint, message);
            
            if (response && response.trim()) {
                hideTyping();
                addMessage(response, false);
                chatStatus.textContent = `‚úÖ Using ${endpoint.name}`;
                success = true;
                break;
            }
        } catch (error) {
            console.log(`${endpoint.name} failed:`, error.message);
            continue;
        }
    }
    
    if (!success) {
        hideTyping();
        addMessage('‚ö†Ô∏è All AI services are currently unavailable. Please try again later or consider setting up your own AI API key.', false);
        chatStatus.textContent = '‚ùå All services failed';
    }
    
    // Re-enable
    sendButton.disabled = false;
    chatInput.disabled = false;
    chatInput.focus();
}

// Query AI endpoint
async function queryAI(endpoint, userMessage) {
    // Prepare messages
    const messages = [
        { role: 'system', content: AI_CONFIG.systemPrompt },
        ...conversationHistory
            .filter(msg => msg.role !== 'system')
            .slice(-4)
            .map(msg => ({ role: msg.role, content: msg.content })),
        { role: 'user', content: userMessage }
    ];
    
    // Prepare request based on endpoint
    let requestBody = {};
    let requestUrl = endpoint.url;
    
    if (endpoint.name.includes('OpenRouter')) {
        requestBody = {
            model: endpoint.model,
            messages: messages,
            max_tokens: 1024,
            temperature: 0.7
        };
    } else if (endpoint.name.includes('HuggingFace')) {
        requestBody = {
            inputs: messages.map(m => m.content).join('\n'),
            parameters: {
                max_new_tokens: 512,
                temperature: 0.7
            }
        };
    }
    
    // Make request
    const response = await fetch(requestUrl, {
        method: 'POST',
        headers: endpoint.headers,
        body: JSON.stringify(requestBody)
    });
    
    if (!response.ok) {
        throw new Error(`HTTP ${response.status}`);
    }
    
    const data = await response.json();
    
    // Parse response based on endpoint
    if (endpoint.name.includes('OpenRouter')) {
        return data.choices?.[0]?.message?.content || 'No response generated';
    } else if (endpoint.name.includes('HuggingFace')) {
        return data[0]?.generated_text || data.generated_text || 'No response generated';
    }
    
    return 'Unknown response format';
}

// Backup: Simple rule-based responses if all APIs fail
function getFallbackResponse(message) {
    const lowerMsg = message.toLowerCase();
    
    if (lowerMsg.includes('sql injection')) {
        return "üîê Cybersecurity Expert: SQL injection is a code injection technique that exploits security vulnerabilities in database layers. Example vulnerable code: `SELECT * FROM users WHERE username = '" + userInput + "'`. Prevention: Use parameterized queries, input validation, and prepared statements.";
    } else if (lowerMsg.includes('osint') || lowerMsg.includes('open source intelligence')) {
        return "üîê Cybersecurity Expert: OSINT involves collecting information from publicly available sources. Tools include: Maltego, Shodan, theHarvester, Recon-ng, and Google dorks. Legal use only for security assessments with proper authorization.";
    } else if (lowerMsg.includes('nmap') || lowerMsg.includes('port scan')) {
        return "üîê Cybersecurity Expert: Nmap is a network scanning tool. Basic commands: `nmap -sS target.com` (stealth scan), `nmap -sV target.com` (version detection), `nmap -O target.com` (OS detection). Always scan only systems you own or have permission to test.";
    } else if (lowerMsg.includes('firewall')) {
        return "üîê Cybersecurity Expert: Firewalls filter network traffic. Types: Packet-filtering, stateful inspection, proxy, and next-generation firewalls. Best practices: Default deny policy, regular rule reviews, segmentation, and logging.";
    }
    
    return "üîê Cybersecurity Expert: I specialize in cybersecurity topics. Please ask about ethical hacking, network security, OSINT, malware analysis, or security best practices. For detailed answers, AI services need to be available.";
}

// Clear history
function clearChatHistory() {
    if (confirm('Clear chat history?')) {
        conversationHistory = [];
        localStorage.removeItem('cyber_chat_history');
        chatMessages.innerHTML = `
            <div class="message bot">
                <div class="message-content">
                    <strong>Cybersecurity AI:</strong> Using free AI model (OpenRouter).<br>
                    Ask me about:<br>
                    ‚Ä¢ Hacking techniques & tools<br>
                    ‚Ä¢ OSINT methods<br>
                    ‚Ä¢ Network security<br>
                    ‚Ä¢ Security best practices<br>
                    <small><em>No API key required. Rate limited.</em></small>
                </div>
            </div>
        `;
    }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    initChatbot();
    
    // Add clear button
    const clearBtn = document.createElement('button');
    clearBtn.textContent = 'Clear';
    clearBtn.style.cssText = `
        position: absolute;
        top: 15px;
        right: 50px;
        background: transparent;
        border: 1px solid #30363d;
        color: #8b949e;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
    `;
    clearBtn.onclick = clearChatHistory;
    document.querySelector('.chat-header').appendChild(clearBtn);
});

// Auto-open
const urlParams = new URLSearchParams(window.location.search);
if (urlParams.get('chat') === 'open') {
    setTimeout(() => chatbotToggle.click(), 1000);
}
</script>
</body>
</html>
